import os
import json
import pdb
import numpy as np

targets = ['/data/hanxinyang/MuNeRF_latest/dataset/girl7']

valid_indexs = ['4943', '3510', '0588', '0558', '3842', '2798', '3867', '2215', '3649', '4390', '4906', '2861', '3540', '2061', '1183', '4174', '3285', '3480', '1163', '3336', '4960', '2212', '0283', '3530', '0357', '4534', '2228', '4414', '0372', '2749', '0653', '0263', '3998', '3297', '0220', '1365', '3952', '4053', '2232', '3266', '1188', '0405', '3814', '3581', '2800', '4172', '3374', '2886', '0307', '4393', '3679', '3431', '1277', '1198', '0245', '3454', '0434', '3946', '2050', '4058', '2069', '1331', '1202', '0414', '0359', '3282', '4113', '3912', '3606', '3361', '4050', '3519', '3937', '1106', '4788', '2222', '1107', '1333', '1211', '2191', '2236', '3779', '3624', '3434', '3364', '3399', '3732', '1131', '0822', '3545', '4956', '3875', '3275', '4065', '4772', '3890', '3301', '1385', '4795', '1108', '4072', '4836', '4087', '3437', '4404', '1337', '3953', '0838', '3317', '4815', '2045', '3500', '4673', '3417', '3295', '3414', '4045', '1305', '3878', '3290', '0338', '4480', '0534', '4428', '4374', '0457', '3640', '4671', '1312', '4937', '3576', '4813', '3784', '4487', '3472', '4000', '3807', '3531', '1181', '3392', '3670', '3641', '0657', '3534', '3655', '3485', '4373', '3675', '3614', '0264', '3621', '1373', '0443', '4888', '4043', '4543', '4378', '4908', '3274', '2553', '4106', '1301', '4812', '1292', '3551', '2231', '3981', '3605', '0269', '3490', '1291', '3367', '3910', '3482', '3787', '3567', '1400', '2733', '0544', '3344', '0527', '3686', '1193', '0618', '4372', '3381', '4408', '2245', '3955', '1286', '1137', '2746', '3281', '1156', '0518', '3239', '3868', '0530', '2862', '0847', '1275', '3700', '0435', '3566', '3252', '4547', '3661', '1367', '1133', '1230', '4830', '0424', '2815', '2868', '3651', '3312', '0824', '4916', '1207', '0520', '1237', '0595', '0253', '1283', '0310', '3406', '0809', '4863', '1128', '4843', '1142', '0612', '3674', '0364', '4409', '0610', '4936', '0368', '4121', '4132', '0514', '3897', '0423', '4823', '3906', '4976', '1361', '1395', '3565', '3502', '4933', '4130', '3247', '0624', '0413', '0243', '0312', '0568', '3635', '4091', '3871', '0513', '0219', '4961', '4012', '0848', '0620', '3734', '0385', '4791', '4107', '4131', '3276', '4476', '3948', '1243', '4901', '0522', '1158', '2072', '4970', '4953', '4965', '3615', '0625', '1330', '4833', '3973', '0308', '0362', '0552', '1182', '1206', '0578', '0407', '3970', '1370', '4541', '0573', '3898', '4147', '0614', '3900', '2742', '1100', '4142', '4128', '0358', '1345', '3356', '4918', '4042', '4911', '2801', '3539', '4527', '3396', '4081', '0230', '0392', '3694', '4832', '4539', '1335', '3752', '2076', '4689', '4123', '4403', '3335', '1126', '3535', '4680', '1280', '4856', '4002', '0383', '4930', '0598', '0825', '4567', '4093', '3611', '3908', '4544', '4417', '3619', '2047', '4115', '3586', '4103', '0654', '4497', '3877', '3665', '4878', '3746', '1358', '2246', '0369', '3699', '4661', '4846', '0449', '2732', '2544', '0395', '4975', '2865', '3978', '3862', '4181', '1391', '0525', '3339', '1192', '1168', '0284', '0438', '2805', '2734', '4821', '3810', '0834', '0249', '1117', '0845', '2534', '3991', '1146', '0393', '3775', '0820', '4502', '0537', '4388', '0399', '3671', '3470', '1371', '1318', '3445', '1306', '3324', '3685', '4354', '4135', '4892', '4783', '1191', '4051', '4413', '1170', '3677', '3507', '1141', '0832', '4853', '2858', '3469', '4679', '3689', '0559', '2813', '1321', '2803', '4670', '2253', '3767', '3722', '2055', '4895', '0410', '3716', '3737', '4083', '3940', '3943', '4529', '0400', '0533', '4122', '2208', '3304', '4910', '0430', '1392', '2056', '3499', '3497', '0292', '2549', '0827', '4485', '1387', '3416', '2237', '4978', '4526', '1115', '2187', '0512', '3486', '0557', '0459', '3584', '0450', '4666', '4925', '2074', '3780', '3764', '0602', '2242', '0343', '0562', '4143', '2211', '4017', '2251', '2811', '0454', '0442', '0318', '4080', '4786', '3770', '3522', '4101', '1123', '3256', '1120', '4955', '3702', '4831', '1116', '3789', '0258', '4971', '0344', '4903', '1150', '4375', '1366', '3987', '2885', '1407', '1196', '3701', '0843', '4873', '3662', '0389', '0367', '1102', '4668', '0363', '3916', '4068', '3800', '0297', '3706', '3234', '3985', '1122', '0352', '2060', '2220', '3921', '3436', '1132', '4942', '4183', '1143', '4023', '0842', '1341', '3931', '3309', '4176', '2536', '1288', '3582', '3634', '3377', '3819', '1290', '3626', '0444', '4967', '4857', '1411', '3362', '0548', '1302', '4384', '4675', '4810', '1225', '3322', '1276', '3552', '4845', '1215', '2221', '3681', '3240', '4887', '2210', '3401', '3310', '3446', '3489', '2816', '4060', '1216', '3524', '3950', '4781', '4659', '4145', '4392', '3796', '4001', '1328', '3795', '3610', '3557', '4477', '0270', '4683', '2070', '0830', '4048', '2877', '4425', '3330', '4877', '3820', '3319', '0528', '4010', '1347', '2876', '1232', '2881', '0575', '0617', '0324', '3802', '1245', '0608', '2240', '4110', '4858', '3690', '1298', '1382', '3885', '0428', '3555', '0549', '3341', '0277', '1195', '3526', '4112', '1342', '0805', '4038', '0629', '1166', '0213', '4007', '1138', '3928', '3719', '3726', '0211', '3249', '4907', '1247', '3602', '3306', '4900', '4875', '1161', '4848', '3765', '4357', '1151', '3334', '0403', '1213', '3917', '3933', '1326', '1113', '2737', '3587', '3742', '3546', '0420', '4991', '3492', '3521', '4835', '4808', '4984', '4837', '4077', '3366', '4076', '0354', '4063', '0599', '3569', '0295', '3965', '2743', '3460', '4993', '3844', '3271', '3279', '0332', '3616', '4917', '0238', '0256', '3866', '0543', '3960', '0320', '0216', '3811', '0429', '2888', '4777', '2736', '4102', '0215', '4479', '3574', '3495', '1350', '3506', '0226', '1310', '0448', '3397', '1348', '4923', '1340', '3739', '3682', '0313', '0812', '3799', '0225', '3387', '1238', '2748', '1140', '2753', '4380', '3544', '2252', '2247', '3761', '4990', '4020', '0412', '4445', '3311', '1268', '3264', '1093', '1175', '1097', '3340', '4501', '4495', '2255', '0605', '3412', '3520', '4880', '4893', '0647', '3895', '4484', '2213', '0408', '4989', '3326', '3883', '4013', '4179', '3262', '4500', '0563', '3529', '1402', '3666', '0529', '3771', '3284', '3391', '1095', '3642', '1410', '4828', '2238', '3559', '3644', '4681', '0439', '2057', '4698', '1412', '3461', '3575', '0452', '1297', '4868', '4935', '3514', '3709', '0236', '2537', '3315', '4968', '1303', '0304', '4133', '4528', '3664', '0378', '4793', '1231', '0840', '4658', '3881', '4871', '2866', '1226', '2206', '0209', '4886', '0328', '3439', '3918', '1121', '3760', '0432', '0572', '4820', '0387', '1315', '1405', '3631', '3477', '2529', '3474', '3617', '1201', '1307', '1127', '1092', '1336', '0550', '4482', '3286', '0570', '3501', '4800', '2257', '3430', '3372', '3958', '4693', '3245', '3612', '0554', '4890', '3410', '4127', '3956', '3327', '3467', '3287', '4866', '3332', '2747', '0275', '0309', '3704', '0460', '0642', '4973', '4394', '2752', '2052', '4920', '4841', '0251', '4047', '0810', '3369', '0427', '0553', '1300', '2554', '3660', '0649', '0342', '0397', '2054', '3407', '3845', '4568', '3269', '4171', '3291', '4897', '1136', '0422', '0398', '0538', '3527', '0285', '4825', '3975', '3817', '3384', '3560', '4395', '1311', '2880', '2556', '3749', '4855', '3777', '2795', '3901', '1346', '3257', '1383', '1356', '0609', '4400', '4061', '1408', '3620', '3776', '3729', '4524', '0365', '3913', '3511', '3762', '3841', '0388', '3947', '0224', '1222', '1112', '3345', '4402', '3657', '4542', '3321', '4095', '0298', '3792', '0458', '3517', '0632', '0380', '4798', '0231', '0402', '3962', '3329', '3547', '2806', '3696', '3251', '4931', '3925', '3261', '3786', '4660', '4011', '0239', '1327', '3556', '1096', '3993', '1221', '4669', '2548', '0287', '3379', '1176', '3785', '4773', '0248', '0419', '4399', '0589', '2543', '0255', '0619', '3645', '0532', '3250', '3669', '3561', '4522', '3536', '4684', '4075', '3294', '4533', '1200', '0437', '3390', '0519', '2067', '4926', '0637', '3325', '1266', '3680', '4696', '4066', '3976', '4840', '4796', '3429', '1087', '4116', '1265', '3923', '2878', '3935', '3725', '3365', '3395', '1322', '0577', '1296', '3715', '3990', '3650', '2071', '0293', '0634', '0325', '4946', '4405', '3601', '0638', '2189', '4553', '3465', '1212', '4947', '0839', '2872', '4678', '0535', '2802', '3432', '0375', '0272', '2539', '4915', '1162', '4952', '0607', '4663', '4940', '1098', '0379', '3797', '0652', '0600', '4985', '4966', '3766', '4100', '4695', '4415', '2857', '3872', '4537', '4865', '4817', '1317', '3622', '3314', '0659', '0594', '4802', '4690', '4098', '0244', '0545', '4105', '3893', '4494', '4475', '2256', '1338', '0279', '0260', '2216', '2233', '4407', '0574', '0303', '2226', '4912', '1397', '3720', '0417', '0214', '2223', '1208', '3911', '4015', '4776', '0433', '0844', '0373', '0823', '4862', '3570', '3724', '4691', '0808', '4120', '3277', '3441', '3440', '3735', '3951', '0555', '3580', '1376', '0350', '0280', '1186', '4861', '4521', '2538', '0650', '2062', '4412', '4805', '4688', '3504', '3647', '1105', '3636', '4549', '3992', '0299', '2551', '1203', '3394', '3865', '3995', '0515', '3505', '0250', '3847', '0233', '4896', '1386', '4905', '3941', '0282', '0813', '3920', '2207', '0818', '1185', '3712', '4922', '0317', '0817', '2064', '3815', '1152', '3809', '3592', '3604', '0337', '1375', '4037', '4921', '1145', '3982', '0294', '4941', '2532', '4951', '3515', '3232', '1167', '3389', '4536', '0623', '2542', '4182', '3471', '4676', '4385', '0584', '0569', '2531', '2860', '3888', '0274', '4538', '3744', '4056', '1351', '2065', '3774', '2890', '4881', '1172', '2049', '3255', '3816', '3812', '0360', '0349', '2883', '3402', '3307', '4988', '1187', '3457', '0523', '3597', '1278', '3359', '4797', '1403', '1343', '2225', '3730', '0644', '4022', '3302', '4446', '1190', '2807', '3790', '4040', '4358', '4071', '1360', '1153', '3705', '2751', '4806', '0333', '3652', '3695', '3609', '0539', '1363', '3750', '1272', '3988', '4842', '4360', '3596', '4363', '3360', '2887', '4096', '0639', '1130', '4073', '4088', '4355', '4775', '3860', '3711', '2533', '1242', '3562', '3516', '0315', '0335', '4362', '4070', '0604', '1241', '4041', '4838', '0319', '0208', '3781', '1415', '4699', '4958', '2873', '4913', '3342', '3846', '3590', '4117', '4685', '4927', '4364', '4778', '0640', '3687', '4108', '3496', '0418', '1287', '3532', '3873', '4491', '3462', '3902', '1267', '1223', '0819', '3246', '3710', '2241', '4118', '3375', '4938', '3554', '0355', '3736', '4057', '3938', '3444', '1388', '4111', '1160', '4898', '3930', '4126', '3745', '3977', '0327', '2738', '1355', '3447', '1180', '2051', '3382', '4948', '3459', '4852', '2796', '3676', '0633', '3475', '3639', '3905', '3409', '1413', '0583', '0582', '4486', '2075', '0585', '3235', '1352', '4427', '3405', '3741', '4420', '3927', '0643', '4792', '1147', '0603', '0645', '3289', '4785', '3549', '0339', '0273', '1177', '3968', '4532', '0815', '2190', '4950', '0445', '4177', '0210', '0390', '1173', '1240', '3481', '3791', '0447', '3697', '4972', '4957', '0221', '4674', '3600', '3509', '4686', '1273', '2250', '3896', '1227', '3672', '4410', '4928', '3254', '0278', '0587', '4178', '2230', '4787', '4816', '0302', '0814', '4369', '0807', '3963', '3684', '4046', '3404', '2754', '4569', '0635', '0415', '1316', '0580', '1332', '3476', '4367', '1197', '4397', '0547', '4694', '1353', '0348', '2875', '4850', '4548', '0560', '0235', '3627', '4822', '0517', '4826', '3241', '3707', '4977', '2863', '4136', '3400', '0218', '4382', '0455', '0404', '3585', '4353', '3386', '4780', '4664', '1086', '3415', '1271', '4782', '3594', '3442', '0377', '1235', '4008', '4847', '3300', '0622', '0828', '4078', '3564', '3632', '0565', '4352', '4665', '0323', '0261', '4138', '3451', '3599', '0425', '4090', '3882', '3656', '4005', '4067', '1091', '3717', '3242', '3769', '0409', '3452', '3456', '1111', '3801', '0347', '3659', '3751', '0453', '4383', '1178', '3491', '3487', '4422', '0223', '1085', '1101', '3727', '3915', '4389', '3512', '2552', '3494', '1110', '0353', '0254', '4986', '4867', '0542', '3805', '4146', '1390', '3740', '4489', '0627', '4490', '1135', '4546', '1401', '0567', '2810', '3579', '4387', '3887', '3886', '2248', '3692', '4882', '0524', '3244', '1218', '3265', '1293', '1125', '1228', '1270', '4870', '4082', '3942', '1148', '0334', '1308', '2547', '3236', '0829', '3997', '2808', '4481', '3370', '4003', '3731', '3876', '2739', '1357', '3986', '4086', '3299', '4554', '1155', '4398', '4092', '3630', '1103', '4962', '1157', '4932', '4085', '3691', '4021', '0382', '4377', '4140', '3337', '3449', '4803', '3450', '4531', '4097', '0837', '3971', '0345', '4872', '3966', '2235', '4818', '1368', '0850', '2227', '4052', '0590', '4851', '3571', '4790', '2243', '1236', '4801', '3747', '1398', '1165', '3794', '4365', '3231', '4125', '3861', '2541', '3577', '4370', '1220', '4499', '4883', '3595', '0288', '0630', '3591', '0658', '3629', '3572', '4983', '3721', '0597', '2882', '1381', '3484', '3936', '3550', '0305', '4963', '3806', '1118', '4018', '0370', '1295', '2741', '4350', '4552', '0593', '0613', '4570', '2192', '3267', '2546', '3542', '3411', '3759', '3272', '4006', '0340', '0329', '1380', '3996', '4379', '2059', '0246', '3464', '3945', '0330', '3667', '4551', '3280', '3903', '0228', '0648', '3466', '3961', '0655', '3259', '3589', '2812', '0564', '4423', '2046', '0628', '4496', '0300', '2217', '0234', '4148', '4902', '3782', '3957', '3714', '0374', '3870', '3654', '1248', '3525', '3967', '1217', '1396', '2797', '3804', '3292', '0835', '2194', '3371', '3541', '4016', '3270', '4860', '0592', '4891', '1378', '0322', '1090', '1205', '3625', '1393', '2867', '3892', '1210', '4359', '1282', '4876', '0229', '1377', '3891', '4368', '3607', '0289', '3230', '2744', '0240', '4173', '3380', '4137', '4419', '0207', '2066', '0394', '0384', '0259', '4141', '4945', '0241', '1320', '4807', '1325', '3260', '1323', '0849', '3385', '1088', '3772', '1246', '1233', '1372', '4492', '3880', '3972', '3316', '0290', '3305', '3646', '4885', '3932', '1281', '3980', '2218', '4418', '3435', '0615', '3983', '1362', '3922', '3320', '2870', '3907', '0440', '0833', '1313', '3863', '3926', '1406', '1171', '1285', '3331', '3357', '3637', '3296', '0314', '2871', '3479', '4062', '4055', '3455', '4811', '4827', '0579', '3237', '3376', '4523', '4474', '4424', '0540', '3537']

valid_indexs.sort()
exp_result = np.zeros((len(valid_indexs), 79))

for target in targets:
    basedir = target
    splits = ["train", "val", "test"]
    for split in splits:
        metas = {}
        for s in splits:
            with open(os.path.join(basedir, f"transforms_{s}.json"), "r") as fp:
                # a = fp.read()
                metas[s] = json.load(fp)
                # a = json.loads(a)

                raw = metas[s]
                new = {}                
                new['focal_len'] =  metas[s]['focal_len']
                new['cx'] = metas[s]['cx']
                new['cy'] = metas[s]['cy']
                new_frames = []
                for i in range(len(metas[s]['frames'])):
                    exp_np =  np.array(metas[s]['frames'][i]['expression'])
                    if "%04d"%metas[s]['frames'][i]['img_id'] in valid_indexs:
                        exp_index = valid_indexs.index("%04d"%metas[s]['frames'][i]['img_id'])
                        exp_result[exp_index] = exp_np
                    
print(exp_result)
np.save(os.path.join("/data/hanxinyang/MuNeRF_latest/debug/H/girl7_expr", "expr.npy"), exp_result)